var O=Object.defineProperty,T=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var k=(e,t,a)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,_=(e,t)=>{for(var a in t||(t={}))j.call(t,a)&&k(e,a,t[a]);if(y)for(var a of y(t))q.call(t,a)&&k(e,a,t[a]);return e},b=(e,t)=>T(e,V(t));var w=(e,t,a)=>new Promise((g,r)=>{var s=n=>{try{i(a.next(n))}catch(l){r(l)}},c=n=>{try{i(a.throw(n))}catch(l){r(l)}},i=n=>n.done?g(n.value):Promise.resolve(n.value).then(s,c);i((a=a.apply(e,t)).next())});import{a as x,e5 as z,s as B,k as v,av as N,ax as p,o as I,h as P,n as f,y as F,F as M,z as S,j as G,ay as W}from"./index.c4bcccae.js";import{I as H}from"./index.e603a1c1.js";import{u as J}from"./index.283107d4.js";import{B as K}from"./BasicForm.11e460f6.js";import{u as Q}from"./useForm.9fc31f81.js";import{l as X}from"./level.a1581236.js";import{B as Y,b as Z}from"./index.a97dab51.js";import{_ as ee,l as C,i as te}from"./PictureDrawer.f0f77004.js";const ge=[{title:"\u5E8F\u53F7",dataIndex:"id",width:200},{title:"\u6635\u79F0",dataIndex:"nickname",width:200},{title:"\u79EF\u5206",dataIndex:"points",width:180},{title:"\u4F59\u989D",dataIndex:"money",width:180},{title:"\u7B49\u7EA7",dataIndex:"level.title",format:(e,t)=>{var a;return(a=t==null?void 0:t.level)==null?void 0:a.title},width:180},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",width:180}],we=[{field:"nickname",label:"\u6635\u79F0",component:"Input",colProps:{span:8}}],ae=[{field:"level_id",label:"\u7B49\u7EA7",required:!0,component:"ApiSelect",componentProps:{api:X,resultField:"items",labelField:"title",valueField:"id"},defaultValue:0},{field:"points",label:"\u79EF\u5206",required:!0,component:"Input"},{field:"money",label:"\u91D1\u989D",required:!0,component:"Input"}],oe=x({name:"CategoryModal",components:{Image:H,BasicModal:Y,BasicForm:K,PictureDrawer:ee,BasicButton:z},emits:["success","register"],setup(e,{emit:t}){const[a,{openDrawer:g}]=J(),r=B(!0),s=B([]),c=B(""),[i,{resetFields:n,setFieldsValue:l,validate:h}]=Q({labelWidth:90,baseColProps:{span:24},schemas:ae,showActionButtonGroup:!1}),[d,{setModalProps:u,closeModal:E}]=Z(o=>w(this,null,function*(){var m;n(),u({confirmLoading:!1}),r.value=!!(o!=null&&o.isUpdate),s.value=(m=(yield C()).images)!=null?m:[],v(r)&&(c.value=o.record.id,l(_({},o.record)))})),R="\u8BE6\u60C5";function $(o){for(let m=0;m<s.value.length;m++){const D=s.value[m];if(D.id==o)return te(D.id)}return""}function U(){return w(this,null,function*(){var o;s.value=(o=(yield C()).images)!=null?o:[]})}function A({ids:o}){l({img_id:(o==null?void 0:o.length)>0?o[0]:null})}function L(){return w(this,null,function*(){try{const o=yield h();u({confirmLoading:!0}),E(),t("success",{isUpdate:v(r),values:b(_({},o),{id:v(r)?c.value:void 0})})}finally{u({confirmLoading:!1})}})}return{images:s,registerModal:d,registerForm:i,getTitle:R,handleSubmit:L,registerDrawer:a,openDrawer:g,getImageUrlById:$,handlePictureDrawerRealod:U,handlePictureDrawerSuccess:A}}});function ne(e,t,a,g,r,s){const c=p("Image"),i=p("BasicButton"),n=p("BasicForm"),l=p("BasicModal"),h=p("PictureDrawer");return I(),P(M,null,[f(l,W(e.$attrs,{onRegister:e.registerModal,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:F(()=>[f(n,{onRegister:e.registerForm},{picDrawer:F(({model:d,field:u})=>[d[u]>0?(I(),P(M,{key:0},[f(c,{src:e.getImageUrlById(d[u]),preview:!1},null,8,["src"]),f(i,{onClick:()=>d[u]=0},{default:F(()=>[S("\u5220\u9664")]),_:2},1032,["onClick"])],64)):(I(),G(i,{key:1,onClick:e.openDrawer},{default:F(()=>[S("\u9009\u62E9\u56FE\u7247")]),_:1},8,["onClick"]))]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title","onOk"]),f(h,{images:e.images,onRegister:e.registerDrawer,onReload:e.handlePictureDrawerRealod,onSuccess:e.handlePictureDrawerSuccess},null,8,["images","onRegister","onReload","onSuccess"])],64)}var re=N(oe,[["render",ne]]),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{re as D,Fe as a,ge as c,we as s};
