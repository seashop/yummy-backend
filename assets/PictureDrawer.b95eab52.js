var A=Object.defineProperty;var E=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var w=(e,a,t)=>a in e?A(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,_=(e,a)=>{for(var t in a||(a={}))L.call(a,t)&&w(e,t,a[t]);if(E)for(var t of E(a))T.call(a,t)&&w(e,t,a[t]);return e};var b=(e,a,t)=>new Promise((i,u)=>{var m=l=>{try{c(t.next(l))}catch(f){u(f)}},n=l=>{try{c(t.throw(l))}catch(f){u(f)}},c=l=>l.done?i(l.value):Promise.resolve(l.value).then(m,n);c((t=t.apply(e,a)).next())});import{n as p,b1 as V,u as $,d$ as D,e0 as j,a as z,ef as H,s as g,o as y,j as P,y as v,k as s,B as G,z as K,i as Z,h as q,F as J,aA as Q,q as W,ay as X,D as Y}from"./index.05f21f62.js";import{I as ee}from"./index.4d00782a.js";import{T as x}from"./index.61c63259.js";import{U as te}from"./index.3b87c3c2.js";import"./index.9a120b4f.js";import{a as ae,B as re}from"./index.02c398aa.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},ne=se;function C(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?Object(arguments[a]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),i.forEach(function(u){le(e,u,t[u])})}return e}function le(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var U=function(a,t){var i=C({},a,t.attrs);return p(V,C({},i,{icon:ne}),null)};U.displayName="UploadOutlined";U.inheritAttrs=!1;var ie=U;const h=$(),ye=e=>D.get({url:"/images",params:e}),ue=e=>D.post({url:"/images",data:e}),oe=h.apiUrl+h.urlPrefix+"/upload",ce=e=>j(h.apiUrl+h.urlPrefix+":common/images/{id}/url",{id:e});var R=(e=>(e[e.FROM_UNSPECIFIED=0]="FROM_UNSPECIFIED",e[e.FROM_USER=1]="FROM_USER",e[e.UNRECOGNIZED=-1]="UNRECOGNIZED",e))(R||{});const de={class:"picutre-drawer-list"},Ue=z({__name:"PictureDrawer",props:{limit:{type:Number,default:1},images:{type:Array,default(){return[]}}},emits:["success","reload","register"],setup(e,{emit:a}){const t=e,i=x.TabPane,u={authorization:H()},m=g("1"),n=g([]),c=g([]),l=g(),{createMessage:f}=Y(),[S,{setDrawerProps:O,closeDrawer:N}]=ae(r=>b(this,null,function*(){n.value=[],c.value=[],l.value=r,O({confirmLoading:!1})})),B="\u56FE\u5E93\u7BA1\u7406";function F(r){const{limit:d}=t;if(!!r.id)if(n.value.indexOf(r.id)!==-1){let o=n.value.indexOf(r.id);n.value.splice(o,1),c.value.splice(o,1)}else if(n.value.length<d)n.value.push(r.id),c.value.push(_({},r));else{f.warn("\u6700\u591A\u9009\u62E9"+d+"\u5F20\u56FE\u7247");return}}function k(r){return r.id&&n.value.indexOf(r.id)>-1?"pic-box":"pic-default"}function I(){return b(this,null,function*(){try{O({confirmLoading:!0}),N(),a("success",{data:s(l),ids:s(n),items:s(c)})}finally{O({confirmLoading:!1})}})}function M(r){r.file.status==="done"&&ue({id:r.file.response.id,from:R.FROM_USER,disk:"cos"}).then(d=>{a("reload")}).catch(d=>{throw d}),r.file.status!=="uploading"&&(r.file,r.fileList),r.file.status==="done"?f.success(`${r.file.name} file uploaded successfully`):r.file.status==="error"&&f.error(`${r.file.name} file upload failed.`)}return(r,d)=>(y(),P(s(re),X(r.$attrs,{onRegister:s(S),showFooter:"",title:B,width:"500px",onOk:I}),{default:v(()=>[p(s(x),{activeKey:m.value,"onUpdate:activeKey":d[0]||(d[0]=o=>m.value=o)},{default:v(()=>[p(s(i),{key:"1",tab:"\u5168\u90E8"})]),_:1},8,["activeKey"]),p(s(te),{name:"attachment",action:s(oe),headers:u,showUploadList:!1,onChange:M},{default:v(()=>[p(s(G),null,{default:v(()=>[p(s(ie)),K(" \u4E0A\u4F20\u56FE\u7247 ")]),_:1})]),_:1},8,["action"]),Z("div",de,[(y(!0),q(J,null,Q(e.images,o=>(y(),P(s(ee),{key:o.id,src:s(ce)(o.id),width:80,preview:!1,class:W(k(o)),onClick:fe=>F(o)},null,8,["src","class","onClick"]))),128))])]),_:1},16,["onRegister"]))}});export{Ue as _,ce as i,ye as l};
