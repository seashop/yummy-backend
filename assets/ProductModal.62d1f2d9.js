var Q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var D=(u,n,t)=>n in u?Q(u,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[n]=t,F=(u,n)=>{for(var t in n||(n={}))Z.call(n,t)&&D(u,t,n[t]);if(B)for(var t of B(n))v.call(n,t)&&D(u,t,n[t]);return u},x=(u,n)=>X(u,Y(n));var p=(u,n,t)=>new Promise((g,I)=>{var k=r=>{try{c(t.next(r))}catch(m){I(m)}},_=r=>{try{c(t.throw(r))}catch(m){I(m)}},c=r=>r.done?g(r.value):Promise.resolve(r.value).then(k,_);c((t=t.apply(u,n)).next())});import{e4 as ee,dU as te,a as ne,v as ue,k as a,f as ie,o as f,h as b,n as l,y as d,F as E,aA as ae,j as U,e5 as R,z as A,es as re,ay as oe,di as se,D as le}from"./index.897eff97.js";import{I as de}from"./index.86d0d66d.js";import"./index.332bc6f0.js";import{u as ce}from"./index.9a8bde03.js";import{B as me}from"./BasicForm.c9112e09.js";import{u as pe}from"./useForm.68d81aa3.js";import fe from"./Sku.b7332f89.js";import{l as V}from"./inns.5c3d1ef4.js";import{l as ge}from"./category.d9c62550.js";import{u as Ie}from"./useComponentRegister.d1d14297.js";import{T as he}from"./index.0754d235.js";import{b as Fe,B as ke}from"./index.98fb7ffc.js";import{i as _e,_ as we,l as Ce}from"./PictureDrawer.b4123ec3.js";import{g as be,u as Ee,c as Pe}from"./product.f54e1f2d.js";Ie("Tinymce",he);const $e=[{title:"\u5E8F\u53F7",dataIndex:"id",width:280},{title:"\u540D\u79F0",dataIndex:"title",width:160},{title:"\u5546\u6237",dataIndex:"innTitle",width:160},{title:"\u5206\u7C7B",dataIndex:"catTitle",width:80},{title:"\u4F7F\u7528SKU",dataIndex:"hasSku",width:80,format:(u,n)=>n!=null&&n.hasSku?"\u662F":"\u5426"},{title:"\u53D1\u5E03\u65F6\u95F4",dataIndex:"createdAt",width:180,format:(u,n)=>n!=null&&n.createdAt?ee(te(n==null?void 0:n.createdAt)):"-"},{title:"\u4EF7\u683C",dataIndex:"price",width:60},{title:"\u6392\u5E8F",dataIndex:"sortId",width:60},{title:"\u72B6\u6001",dataIndex:"status",width:60}],ze=[{field:"innId",label:"\u5546\u6237",required:!0,component:"ApiSelect",componentProps:({formModel:u})=>({api:V,resultField:"inns",labelField:"title",valueField:"id",onOptionsChange:n=>{n.length>0&&(u.innId=n[0].value)}}),colProps:{span:8}},{field:"title",label:"\u540D\u79F0",component:"Input",colProps:{span:8}}],T=[{field:"title",label:"\u540D\u79F0",required:!0,component:"Input"},{field:"imgIds",label:"\u9910\u54C1\u56FE\u7247",required:!0,slot:"picDrawer",component:"Input"},{field:"innId",label:"\u6240\u5C5E\u5546\u6237",required:!0,component:"ApiSelect",componentProps:({formModel:u,schema:n})=>({api:V,resultField:"inns",labelField:"title",valueField:"id",onOptionsChange:t=>{t.length>0&&(n.defaultValue=t[0].value,u.innId=t[0].value)}})},{field:"catId",label:"\u6240\u5C5E\u5206\u7C7B",required:!0,component:"ApiSelect",componentProps:({formModel:u,schema:n})=>u.innId?{api:ge,params:{innId:u.innId},resultField:"productCats",labelField:"title",valueField:"id",onOptionsChange:t=>{t.length>0&&(n.defaultValue=t[0].value,u.catId=t[0].value)}}:{}},{field:"sortId",label:"\u6392\u5E8F",required:!0,component:"InputNumber",colProps:{span:8},defaultValue:0},{field:"hasSku",label:"\u662F\u5426\u4F7F\u7528SKU",required:!0,component:"Switch",defaultValue:!1},{field:"price",label:"\u9500\u552E\u4EF7\u683C",required:!0,component:"InputNumber",colProps:{span:8}},{field:"stock",label:"\u603B\u5E93\u5B58",required:!0,component:"InputNumber",colProps:{span:12}},{field:"content",label:"\u5546\u54C1\u8BE6\u60C5",required:!0,component:"Tinymce",componentProps:{showImageUpload:!1},defaultValue:""}],Se=ne({__name:"ProductModal",emits:["success","register","back"],setup(u,{emit:n}){const t=ue({innId:"",sub:0,sku_comfirm:0,rdata:[],isUpdate:!0,images:[],rowId:""}),{createMessage:g}=le(),[I,{openDrawer:k}]=ce();function _(){return t.innId=q().innId,k}const[c,{resetFields:r,resetSchema:m,getFieldsValue:q,setFieldsValue:w,validate:M}]=pe({labelWidth:90,baseColProps:{span:24},schemas:T,showActionButtonGroup:!1}),[O,{setModalProps:C,closeModal:N}]=Fe(e=>p(this,null,function*(){if(m(T),r(),t.rdata=void 0,t.rowId="",C({confirmLoading:!1}),t.isUpdate=!!(e!=null&&e.isUpdate),a(t.isUpdate)){const i=yield be(e.record.innId,e.record.id);t.rowId=i.id,(i==null?void 0:i.skuAttrIds.length)>0&&(w({hasSku:!0}),t.rdata=i.skuAttrIds),w(F({},i))}})),L=ie(()=>a(t.isUpdate)?"\u7F16\u8F91\u5546\u54C1":"\u65B0\u589E\u5546\u54C1");function j(e,i){switch(e){case"innId":t.innId=i;break}}function $(e){return e!=null&&e.show_sku?(e.sku=h.list,e.sku_img_ids=h.sku_img_id):(e.sku=[],e.sku_img_ids=[]),e}function P(){return p(this,null,function*(){var e;t.images=(e=(yield Ce()).images)!=null?e:[]})}P();function z({data:e,items:i}){let o={};se(o,e.field,(i==null?void 0:i.length)>0?i.map(s=>s.id):[]),w(o)}function K(e){return e.banner_imgs&&!e.banner_imgs[0]?(e.banner_imgs,g.error("\u672A\u9009\u62E9\u5546\u54C1\u56FE\u7247"),!1):e.fx_money*1>e.price*1?(g.error("\u5206\u9500\u4F63\u91D1\u5FC5\u987B\u5C0F\u4E8E\u9500\u552E\u4EF7\u683C"),!1):!0}function G(e){if(!!K(e))return(e==null?void 0:e.sku)!==void 0&&(e.price=e.sku[0].price,e.stock=e.sku[0].stock_num),e}function W(e){return x(F({},e),{id:t.rowId})}let h={};function H(e){return p(this,null,function*(){h=F({},e)})}function J(){return p(this,null,function*(){try{let e=yield M();if(e.show_sku&&(e=$(e)),C({confirmLoading:!0}),e=t.isUpdate?W(e):G(e),e===void 0)return;const i=t.isUpdate?yield Ee(e):yield Pe(e);e==null||e.value,N(),n("success",{result:i})}finally{C({confirmLoading:!1})}})}return(e,i)=>(f(),b(E,null,[l(a(ke),oe(e.$attrs,{onRegister:a(O),showFooter:"",title:a(L),width:"500px",onOk:J}),{default:d(()=>[l(a(me),{onRegister:a(c),onFieldValueChange:j},{picDrawer:d(({model:o,field:s})=>{var S;return[((S=o[s])==null?void 0:S.length)>0?(f(),b(E,{key:0},[(f(!0),b(E,null,ae(o[s],y=>(f(),U(a(de),{key:y,src:a(_e)(y),width:60,preview:!1},null,8,["src"]))),128)),l(R,{onClick:()=>o[s]=0},{default:d(()=>[A("\u5220\u9664")]),_:2},1032,["onClick"])],64)):(f(),U(R,{key:1,onClick:()=>_()(!0,{field:s})},{default:d(()=>[A(" \u9009\u62E9\u56FE\u7247 ")]),_:2},1032,["onClick"]))]}),sku:d(({})=>[l(a(re),null,{default:d(()=>[l(fe,{rdata:t.rdata,onResult:H},null,8,["rdata"])]),_:1})]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title"]),l(we,{images:t.images,limit:3,onRegister:a(I),onReload:P,onSuccess:z},null,8,["images","onRegister"])],64))}});var Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));export{Ke as P,Se as _,$e as c,ze as s};
