var O=Object.defineProperty,T=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var k=(e,t,a)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,B=(e,t)=>{for(var a in t||(t={}))j.call(t,a)&&k(e,a,t[a]);if(y)for(var a of y(t))q.call(t,a)&&k(e,a,t[a]);return e},P=(e,t)=>T(e,V(t));var w=(e,t,a)=>new Promise((f,n)=>{var s=r=>{try{i(a.next(r))}catch(l){n(l)}},c=r=>{try{i(a.throw(r))}catch(l){n(l)}},i=r=>r.done?f(r.value):Promise.resolve(r.value).then(s,c);i((a=a.apply(e,t)).next())});import{a as x,e5 as z,s as v,k as _,av as N,ax as p,o as I,h as b,n as g,y as F,F as M,z as S,j as G,ay as W}from"./index.71d27ec8.js";import{I as H}from"./index.e69e205a.js";import{u as J}from"./index.50038997.js";import{B as K}from"./BasicForm.ecc16293.js";import{u as Q}from"./useForm.1ef3442d.js";import{l as X}from"./level.4748163a.js";import{B as Y,b as Z}from"./index.6cd30c01.js";import{P as ee,l as C,i as te}from"./PictureDrawer.d169ad75.js";const fe=[{title:"\u5E8F\u53F7",dataIndex:"id",width:200},{title:"\u6635\u79F0",dataIndex:"nickname",width:200},{title:"\u79EF\u5206",dataIndex:"points",width:180},{title:"\u4F59\u989D",dataIndex:"money",width:180},{title:"\u7B49\u7EA7",dataIndex:"level.title",format:(e,t)=>{var a;return(a=t==null?void 0:t.level)==null?void 0:a.title},width:180},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"created_at",width:180}],we=[{field:"nickname",label:"\u6635\u79F0",component:"Input",colProps:{span:8}}],ae=[{field:"level_id",label:"\u7B49\u7EA7",required:!0,component:"ApiSelect",componentProps:{api:X,resultField:"items",labelField:"title",valueField:"id"},defaultValue:0},{field:"points",label:"\u79EF\u5206",required:!0,component:"Input"},{field:"money",label:"\u91D1\u989D",required:!0,component:"Input"}],oe=x({name:"CategoryModal",components:{Image:H,BasicModal:Y,BasicForm:K,PictureDrawer:ee,BasicButton:z},emits:["success","register"],setup(e,{emit:t}){const[a,{openDrawer:f}]=J(),n=v(!0),s=v([]),c=v(""),[i,{resetFields:r,setFieldsValue:l,validate:h}]=Q({labelWidth:90,baseColProps:{span:24},schemas:ae,showActionButtonGroup:!1}),[d,{setModalProps:u,closeModal:E}]=Z(o=>w(this,null,function*(){var m;r(),u({confirmLoading:!1}),n.value=!!(o!=null&&o.isUpdate),s.value=(m=(yield C()).images)!=null?m:[],_(n)&&(c.value=o.record.id,l(B({},o.record)))})),R="\u8BE6\u60C5";function $(o){for(let m=0;m<s.value.length;m++){const D=s.value[m];if(D.id==o)return te(D.id)}return""}function U(){return w(this,null,function*(){var o;s.value=(o=(yield C()).images)!=null?o:[]})}function A({ids:o}){l({img_id:(o==null?void 0:o.length)>0?o[0]:null})}function L(){return w(this,null,function*(){try{const o=yield h();u({confirmLoading:!0}),E(),t("success",{isUpdate:_(n),values:P(B({},o),{id:_(n)?c.value:void 0})})}finally{u({confirmLoading:!1})}})}return{images:s,registerModal:d,registerForm:i,getTitle:R,handleSubmit:L,registerDrawer:a,openDrawer:f,getImageUrlById:$,handlePictureDrawerRealod:U,handlePictureDrawerSuccess:A}}});function re(e,t,a,f,n,s){const c=p("Image"),i=p("BasicButton"),r=p("BasicForm"),l=p("BasicModal"),h=p("PictureDrawer");return I(),b(M,null,[g(l,W(e.$attrs,{onRegister:e.registerModal,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:F(()=>[g(r,{onRegister:e.registerForm},{picDrawer:F(({model:d,field:u})=>[d[u]>0?(I(),b(M,{key:0},[g(c,{src:e.getImageUrlById(d[u]),preview:!1},null,8,["src"]),g(i,{onClick:()=>d[u]=0},{default:F(()=>[S("\u5220\u9664")]),_:2},1032,["onClick"])],64)):(I(),G(i,{key:1,onClick:e.openDrawer},{default:F(()=>[S("\u9009\u62E9\u56FE\u7247")]),_:1},8,["onClick"]))]),_:1},8,["onRegister"])]),_:1},16,["onRegister","title","onOk"]),g(h,{images:e.images,onRegister:e.registerDrawer,onReload:e.handlePictureDrawerRealod,onSuccess:e.handlePictureDrawerSuccess},null,8,["images","onRegister","onReload","onSuccess"])],64)}var ne=N(oe,[["render",re]]),Fe=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));export{ne as D,Fe as a,fe as c,we as s};
