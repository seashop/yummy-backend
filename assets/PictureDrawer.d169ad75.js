var T=Object.defineProperty;var D=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var k=(e,a,t)=>a in e?T(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,$=(e,a)=>{for(var t in a||(a={}))A.call(a,t)&&k(e,t,a[t]);if(D)for(var t of D(a))L.call(a,t)&&k(e,t,a[t]);return e};var w=(e,a,t)=>new Promise((r,s)=>{var p=o=>{try{u(t.next(o))}catch(c){s(c)}},i=o=>{try{u(t.throw(o))}catch(c){s(c)}},u=o=>o.done?r(o.value):Promise.resolve(o.value).then(p,i);u((t=t.apply(e,a)).next())});import{n as f,b1 as V,u as j,d$ as F,e0 as z,a as H,B as N,s as g,ef as K,av as M,k as O,ax as d,o as P,j as E,y as v,z as x,i as R,h as q,F as G,aA as J,q as Q,ay as W,D as X}from"./index.71d27ec8.js";import{I as Y}from"./index.e69e205a.js";import{T as h}from"./index.5cecd89c.js";import{U as Z}from"./index.5dab2e2c.js";import"./index.b332413b.js";import{B as ee,a as ae}from"./index.50038997.js";var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},ne=te;function S(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?Object(arguments[a]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),r.forEach(function(s){re(e,s,t[s])})}return e}function re(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var B=function(a,t){var r=S({},a,t.attrs);return f(V,S({},r,{icon:ne}),null)};B.displayName="UploadOutlined";B.inheritAttrs=!1;var se=B;const b=j(),ye=e=>F.get({url:"/images",params:e}),oe=e=>F.post({url:"/images",data:e}),le=b.apiUrl+b.urlPrefix+"/upload",ie=e=>z(b.apiUrl+b.urlPrefix+":common/images/{id}/url",{id:e});const ue=H({name:"PictureDrawer",components:{BasicDrawer:ee,Image:Y,[h.name]:h,[h.TabPane.name]:h.TabPane,Button:N,Upload:Z,UploadOutlined:se},props:{limit:{type:Number,default:1},innId:{type:String},images:{type:Array,default(){return[]}}},emits:["success","reload","register"],setup(e,{emit:a}){const t=g("1"),r=g([]),s=g([]),p=g(),{createMessage:i}=X(),[u,{setDrawerProps:o,closeDrawer:c}]=ae(n=>w(this,null,function*(){r.value=[],s.value=[],p.value=n,o({confirmLoading:!1})})),y="\u56FE\u5E93\u7BA1\u7406";function _(n){const{limit:m}=e;if(r.value.indexOf(n.id)!==-1){let C=r.value.indexOf(n.id);r.value.splice(C,1),s.value.splice(C,1)}else if(r.value.length<m)r.value.push(n.id),s.value.push($({},n));else{i.warn("\u6700\u591A\u9009\u62E9"+m+"\u5F20\u56FE\u7247");return}}function U(n){return r.value.indexOf(n.id)>-1?"pic-box":"pic-default"}function l(){return w(this,null,function*(){try{o({confirmLoading:!0}),c(),a("success",{data:O(p),ids:O(r),items:O(s)})}finally{o({confirmLoading:!1})}})}function I(n){n.file.status==="done"&&oe({id:n.file.response.id,innId:e.innId,from:"backend",disk:"cos"}).then(m=>{a("reload")}).catch(m=>{throw m}),n.file.status!=="uploading"&&(n.file,n.fileList),n.file.status==="done"?i.success(`${n.file.name} file uploaded successfully`):n.file.status==="error"&&i.error(`${n.file.name} file upload failed.`)}return{props:e,registerDrawer:u,getTitle:y,activeKey:t,data:p,chooseImg:_,tabCss:U,uploadUrl:le,upfileHeaders:{authorization:K()},handleUploadChange:I,handleSubmit:l,imageUrl:ie}}}),ce={class:"picutre-drawer-list"};function de(e,a,t,r,s,p){const i=d("a-tab-pane"),u=d("a-tabs"),o=d("UploadOutlined"),c=d("Button"),y=d("Upload"),_=d("Image"),U=d("BasicDrawer");return P(),E(U,W(e.$attrs,{onRegister:e.registerDrawer,showFooter:"",title:e.getTitle,width:"500px",onOk:e.handleSubmit}),{default:v(()=>[f(u,{activeKey:e.activeKey,"onUpdate:activeKey":a[0]||(a[0]=l=>e.activeKey=l)},{default:v(()=>[f(i,{key:"1",tab:"\u5168\u90E8"})]),_:1},8,["activeKey"]),f(y,{name:"attachment",action:e.uploadUrl,headers:e.upfileHeaders,showUploadList:!1,onChange:e.handleUploadChange},{default:v(()=>[f(c,null,{default:v(()=>[f(o),x(" \u4E0A\u4F20\u56FE\u7247 ")]),_:1})]),_:1},8,["action","headers","onChange"]),R("div",ce,[(P(!0),q(G,null,J(e.images,l=>(P(),E(_,{key:l.id,src:e.imageUrl(l.id),width:80,preview:!1,class:Q(e.tabCss(l)),onClick:I=>e.chooseImg(l)},null,8,["src","class","onClick"]))),128))])]),_:1},16,["onRegister","title","onOk"])}var _e=M(ue,[["render",de]]);export{_e as P,ie as i,ye as l};
