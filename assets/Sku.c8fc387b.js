var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var q=(t,u,r)=>u in t?X(t,u,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[u]=r,O=(t,u)=>{for(var r in u||(u={}))x.call(u,r)&&q(t,r,u[r]);if(j)for(var r of j(u))ee.call(u,r)&&q(t,r,u[r]);return t},G=(t,u)=>Y(t,Z(u));var H=(t,u,r)=>new Promise((E,n)=>{var h=f=>{try{C(r.next(f))}catch(_){n(_)}},N=f=>{try{C(r.throw(f))}catch(_){n(_)}},C=f=>f.done?E(f.value):Promise.resolve(f.value).then(h,N);C((r=r.apply(t,u)).next())});import{a as te,B as ne,b8 as se,I as oe,e5 as ue,v as ae,s as I,f as J,a6 as z,be as K,av as le,ax as S,o as c,h as d,i as p,F as y,aA as B,n as k,j as T,y as D,z as P,l as F,w as re,x as ie,t as M}from"./index.05f21f62.js";import{C as ce}from"./index.a55a4d9b.js";import{I as pe}from"./index.4d00782a.js";import{I as me}from"./index.85eb05f3.js";import{_ as de,l as ge}from"./PictureDrawer.b95eab52.js";import{u as fe}from"./index.02c398aa.js";import{g as ve}from"./get.ab1579f8.js";import"./Checkbox.1e5d27b2.js";import"./index.61c63259.js";import"./useRefs.1930efb1.js";import"./PlusOutlined.d7f809b2.js";import"./index.3b87c3c2.js";import"./_baseIteratee.94f70879.js";import"./DeleteOutlined.f664363c.js";import"./index.9a120b4f.js";import"./Form.823f88cb.js";import"./Col.8f679cd2.js";import"./useFlexGapSupport.ed791f76.js";import"./useSize.b22e5468.js";import"./index.fea0c2f3.js";import"./ArrowLeftOutlined.f2895767.js";const _e=te({name:"Sku",components:{Button:ne,Checkbox:ce,Icon:se,Image:pe,Input:oe,InputNumber:me,PictureDrawer:de,BasicButton:ue},props:{rdata:{type:Object,defualt:null}},emits:["result"],setup(t,{emit:u}){const[r,{openDrawer:E}]=fe(),n=ae({counter:I(0),images:I([]),useSpecImg:I(!1),drawer:I(!1),attrs:I([]),attrsImageId:I([]),ovConfig:I(),imgList:I([]),tableSku:I([])}),h=J(()=>{if(n.attrs.length==0)return[];let e=[];for(let s=0;s<n.attrs.length;s++){let o={pName:n.attrs[s].pName,spec:[],price:null,stock_num:null,specLen:0,rowspan:1},i=n.attrs[s].spec.length,l=0;for(let g=0;g<i;g++){let w=n.attrs[s].spec[g].cName;if(!w)continue;let U={cName:w};++l,o.spec.push(U)}o.specLen=l,e.push(o)}for(let s=0,o=e.length;s<o;s++){let i=1;for(let l=s+1;l<o;l++)i*=e[l].specLen||1;e[s].rowspan=i}return e}),N=J(()=>{let e=1,s=h.value.length;if(s==0)return 0;for(let o=0;o<s;o++)e*=h.value[o].specLen||1;return e==1?h.value[0].spec.length:e});function C(e,s){var i;const o=(i=n.ovConfig)==null?void 0:i.list;if(o&&o[e])return ve(o[e],s,void 0)}function f(){h.value||(n.tableSku=[]);let e=[];const s=h.value;for(let o=0;o<N.value;o++){let i={price:C(o,"price"),stock_num:C(o,"stock_num")};for(let l=0;l<s.length;l++){let g=s[l].pName,w=s[l].rowspan,U=s[l].specLen;if(!U)continue;let Q=s[l].spec,W=parseInt(o/w)%U;i[g]=Q[W].cName}e.push(i)}n.tableSku=[...e]}z(()=>t.rdata,e=>{n.ovConfig=e?O({},e):void 0,A(e)},{immediate:!0}),z([K(n).counter,n.tableSku,n.attrsImageId],()=>{_()},{immediate:!0,deep:!0}),z([n.attrs,n.ovConfig],()=>{f(),_()},{immediate:!0});function _(){u("result",{list:n.tableSku,sku_img_id:n.useSpecImg?n.attrsImageId:[]})}function L(){return H(this,null,function*(){n.images=(yield ge()).items})}L();function R({data:e,items:s}){let o=(s==null?void 0:s.length)>0?s[0]:void 0;n.attrs[0].spec[e.specIdx].pic=o==null?void 0:o.full_url,n.attrsImageId[e.specIdx]=o?o.id:0}function A(e){if(e!==void 0)for(let s=0;s<e.tree.length;s++){if(n.attrs.length>=3)continue;const o=e.tree[s];let i=[];for(let g=0;g<o.v.length;g++){const w=o.v[g];i[g]={},i[g].cName=w.name,s==0&&(w.img_id?(i[g].pic=w.imgUrl,n.attrsImageId.splice(g,1,w.img_id),n.useSpecImg=!0):n.useSpecImg=!1)}const l={pName:o.k,rowspan:1,spec:i};n.attrs.push(l)}}function V(){let e={pName:"",rowspan:1,spec:[{cName:""}]};n.attrs.length>=3||n.attrs.push(e)}function v(e){n.imgList=[],n.attrs.splice(e,1)}function m(e){n.attrs[e].spec.push({cName:""})}function a(e,s){n.attrs[e].spec.splice(s,1)}function b(e,s){if(e){let o=parseInt(s/e.rowspan),i=e.specLen||1,l=o%i;return e.spec&&e.spec[l]&&e.spec[l].cName}}function $(){n.attrs=[]}return G(O({},K(n)),{registerDrawer:r,openDrawer:E,handlePictureDrawerRealod:L,handlePictureDrawerSuccess:R,rows:N,tableSpu:h,debugPrint:()=>{_()},addItem:V,toDelete:v,addSpu:m,delSpu:a,getName:b,getOvValue:C,clear:$})}}),ke={id:"sku_tag"},he={class:"form-group"},Ce=p("div",{class:"form-h"},"\u5546\u54C1\u89C4\u683C",-1),we={class:"form-title"},Ie={class:"form-list"},Se={class:"spgg_r_02_2"},Ne={key:0},be=["onClick"],ye={key:0,class:"spgg_r_04"},Be={class:"form-btn-group"},De={class:"form-table"},Fe=p("div",{class:"stock-title"},"\u5546\u54C1\u5E93\u5B58",-1),Ee={class:"table-sku",border:"1px solid #ccc"},Le=p("th",{width:"200"},"\u4EF7\u683C",-1),Ae=p("th",{width:"200"},"\u5E93\u5B58",-1),$e=["rowspan"];function Ue(t,u,r,E,n,h){const N=S("Input"),C=S("Checkbox"),f=S("Icon"),_=S("Button"),L=S("Image"),R=S("BasicButton"),A=S("InputNumber"),V=S("PictureDrawer");return c(),d("div",ke,[p("div",he,[Ce,(c(!0),d(y,null,B(t.attrs,(v,m)=>(c(),d("div",{class:"form-item",key:m},[p("div",we,[k(N,{class:"sku-name",value:v.pName,"onUpdate:value":a=>v.pName=a,placeholder:"\u89C4\u683C\u540D"},null,8,["value","onUpdate:value"]),m==0?(c(),T(C,{key:0,checked:t.useSpecImg,"onUpdate:checked":u[0]||(u[0]=a=>t.useSpecImg=a)},{default:D(()=>[P("\u6DFB\u52A0\u89C4\u683C\u56FE\u7247")]),_:1},8,["checked"])):F("",!0),k(_,{type:"text",style:{float:"right"},onClick:a=>t.toDelete(m)},{icon:D(()=>[k(f,{icon:"ant-design:delete-outlined",color:"red"})]),_:2},1032,["onClick"])]),p("ul",Ie,[(c(!0),d(y,null,B(v.spec,(a,b)=>(c(),d("li",{key:b},[p("div",Se,[k(N,{value:a.cName,"onUpdate:value":$=>a.cName=$},null,8,["value","onUpdate:value"]),k(_,{type:"text",class:"in_clo",onClick:$=>t.delSpu(m,b)},{default:D(()=>[k(f,{icon:"ant-design:close-outlined",style:{color:"#cecece"}})]),_:2},1032,["onClick"])]),t.useSpecImg&&m==0?(c(),d("div",Ne,[t.useSpecImg?(c(),d("div",{key:0,class:"sku_idx_img",onClick:()=>t.openDrawer(!0,{specIdx:b})},[a.pic?(c(),T(L,{key:0,src:a.pic},null,8,["src"])):(c(),T(f,{key:1,icon:"ant-design:plus-outlined",class:"sku-img"}))],8,be)):F("",!0)])):F("",!0)]))),128)),p("li",null,[P(" \u2003 "),k(R,{onClick:a=>t.addSpu(m)},{default:D(()=>[P("\u6DFB\u52A0")]),_:2},1032,["onClick"])])]),t.useSpecImg&&m==0?(c(),d("div",ye," \u4EC5\u652F\u6301\u4E3A\u7B2C\u4E00\u7EC4\u89C4\u683C\u8BBE\u7F6E\u89C4\u683C\u56FE\u7247\uFF0C\u5EFA\u8BAE\u5C3A\u5BF8\uFF1A160*160\u50CF\u7D20 ")):F("",!0)]))),128)),p("div",Be,[k(_,{size:"small",disabled:t.attrs.length==3,type:"default",name:"",onClick:t.addItem},{default:D(()=>[P(" \u6DFB\u52A0\u89C4\u683C\u9879\u76EE ")]),_:1},8,["disabled","onClick"])]),re(p("div",De,[Fe,p("table",Ee,[p("thead",null,[p("tr",null,[(c(!0),d(y,null,B(t.tableSpu,(v,m)=>(c(),d("th",{key:m},M(v.pName),1))),128)),Le,Ae])]),p("tbody",null,[(c(!0),d(y,null,B(t.tableSku,(v,m)=>(c(),d("tr",{key:m},[(c(!0),d(y,null,B(t.tableSpu,(a,b)=>(c(),d(y,null,[m%a.rowspan?F("",!0):(c(),d("td",{rowspan:a.rowspan,key:b},M(t.getName(a,m)),9,$e))],64))),256)),p("td",null,[k(A,{value:v.price,"onUpdate:value":a=>v.price=a,onChange:u[1]||(u[1]=a=>t.counter++),placeholder:"\u5355\u4EF7"},null,8,["value","onUpdate:value"])]),p("td",null,[k(A,{value:v.stock_num,"onUpdate:value":a=>v.stock_num=a,onChange:u[2]||(u[2]=a=>t.counter++),placeholder:"\u5E93\u5B58"},null,8,["value","onUpdate:value"])])]))),128))])])],512),[[ie,t.tableSpu]])]),k(V,{images:t.images,length:1,onRegister:t.registerDrawer,onReload:t.handlePictureDrawerRealod,onSuccess:t.handlePictureDrawerSuccess},null,8,["images","onRegister","onReload","onSuccess"])])}var st=le(_e,[["render",Ue]]);export{st as default};
